"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var http_1 = require('angular2/http');
var core_1 = require('angular2/core');
require('rxjs/add/operator/map');
require('rxjs/add/operator/toPromise');
var Rx = require('rxjs/Rx');
var BASE_URL = 'http://localhost:3030/api/';
var HEADER = { headers: new http_1.Headers({ 'Content-Type': 'image/jpeg' }) };
var HegelService = (function () {
    function HegelService(http) {
        var _this = this;
        this.http = http;
        this.socket = io('http://localhost:3030', { reconnect: true });
        this.socket.on("wikiSend", function (msg) {
            msg = { msg: msg };
            _this.socket.emit('received', msg, function (data) { });
        });
        this.mouseup = this.fromDOMSource('mouseup', window.document).map(function (pos) { return _this.getSelectionText(pos); });
    }
    HegelService.prototype.fromDOMSource = function (eventName, el) {
        return Rx.Observable.fromEventPattern(function (callback) { return el.addEventListener(eventName, callback, false); }, function (callback) { return el.removeEventListener(eventName, callback); });
    };
    HegelService.prototype.handleWikipediaLink = function ($event) {
        console.log("Gotta handle that!");
        var href = $event.srcElement.href;
        href = href.slice(27, href.length);
        return this.getWiki(href);
    };
    HegelService.prototype.getWiki = function (word) {
        word = this.replaceUnderscoreAndCap(word);
        word = word.replace(/\_/g, " ");
        console.log("Getting word" + word);
        this.requestWiki(word).subscribe(function (res) {
            res = JSON.parse(res);
            if (res.type === "html") {
                console.log("HTML");
                return res.results;
            }
            else if (res.type === 'terms') {
                console.log("TERMS");
                return res.results;
            }
        });
    };
    HegelService.prototype.replaceUnderscoreAndCap = function (word) {
        word = word.charAt(0).toUpperCase() + word.slice(1);
        word = word.replace(/\_/g, " ");
        return word;
    };
    HegelService.prototype.getSelectionText = function () {
        console.log("Getting selection text");
        var text = "";
        if (window.getSelection) {
            text = window.getSelection().toString();
        }
        else if (document.selection && document.selection.type != "Control") {
            text = document.selection.createRange().text;
        }
        console.log("Selection text: ", text);
        return text;
    };
    HegelService.prototype.getHegel = function (num) {
        return this.http.get(BASE_URL + "hegels/" + num, HEADER)
            .map(function (res) { return res.json(); }).map(function (res) { return res[0]; });
    };
    HegelService.prototype.requestWiki = function (word) {
        console.log("Getting Wiki :", word);
        if (word !== "") {
            return this.http.get(BASE_URL + "wiki/" + word)
                .map(function (res) { return res._body; });
        }
    };
    HegelService = __decorate([
        core_1.Injectable(), 
        __metadata('design:paramtypes', [http_1.Http])
    ], HegelService);
    return HegelService;
}());
exports.HegelService = HegelService;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNoYXJlZC9zZXJ2aWNlcy9oZWdlbC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQSxxQkFBNEIsZUFBZSxDQUFDLENBQUE7QUFDNUMscUJBQStDLGVBQWUsQ0FBQyxDQUFBO0FBRS9ELFFBQU8sdUJBQXVCLENBQUMsQ0FBQTtBQUMvQixRQUFPLDZCQUE2QixDQUFDLENBQUE7QUFDckMsSUFBWSxFQUFFLFdBQU0sU0FBUyxDQUFDLENBQUE7QUFHOUIsSUFBTSxRQUFRLEdBQUcsNEJBQTRCLENBQUM7QUFDOUMsSUFBTSxNQUFNLEdBQUcsRUFBRSxPQUFPLEVBQUUsSUFBSSxjQUFPLENBQUMsRUFBRSxjQUFjLEVBQUUsWUFBWSxFQUFDLENBQUUsRUFBQyxDQUFDO0FBSXpFO0lBS0ksc0JBQW9CLElBQVU7UUFMbEMsaUJBcUdDO1FBaEd1QixTQUFJLEdBQUosSUFBSSxDQUFNO1FBQzFCLElBQUksQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDLHVCQUF1QixFQUFFLEVBQUMsU0FBUyxFQUFFLElBQUksRUFBQyxDQUFDLENBQUM7UUFDN0QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsVUFBVSxFQUFFLFVBQUMsR0FBTztZQUMvQixHQUFHLEdBQUcsRUFBQyxHQUFHLEVBQUUsR0FBRyxFQUFDLENBQUM7WUFDakIsS0FBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLEdBQUcsRUFBRSxVQUFVLElBQVEsSUFBRyxDQUFDLENBQUMsQ0FBQztRQUM5RCxDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxTQUFTLEVBQUUsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFDLEdBQUcsSUFBSSxNQUFNLENBQUMsS0FBSSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxDQUFBLENBQUEsQ0FBQyxDQUFDLENBQUM7SUFDbEgsQ0FB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Q0FBQyxrQkFBa0IsRUFBRyxJQUFJLENBQUMsQ0FBQTtRQUN0QyxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFDRCwrQkFBUSxHQUFSLFVBQVMsR0FBVTtRQUNmLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEdBQUcsU0FBUyxHQUFHLEdBQUcsRUFBRyxNQUFNLENBQUM7YUFDcEQsR0FBRyxDQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsR0FBRyxDQUFDLElBQUksRUFBRSxFQUFWLENBQVUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFBLEdBQUcsSUFBSSxPQUFBLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBTixDQUFNLENBQUMsQ0FBQztJQUNuRCxDQUFDO0lBQ0Qsa0NBQVcsR0FBWCxVQUFZLElBQVc7UUFDbkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRyxJQUFJLENBQUUsQ0FBQztRQUN0QyxFQUFFLENBQUEsQ0FBRSxJQUFJLEtBQUssRUFBRSxDQUFDLENBQUEsQ0FBQztZQUNiLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEdBQUcsT0FBTyxHQUFHLElBQUksQ0FBQztpQkFDMUMsR0FBRyxDQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsR0FBRyxDQUFDLEtBQUssRUFBVCxDQUFTLENBQUMsQ0FBQztRQUMvQixDQUFDO0lBQ0wsQ0FBQztJQXZFTDtRQUFDLGlCQUFVLEVBQUU7O29CQUFBO0lBdUdiLG1CQUFDO0FBQUQsQ0FyR0EsQUFxR0MsSUFBQTtBQXJHWSxvQkFBWSxlQXFHeEIsQ0FBQSIsImZpbGUiOiJzaGFyZWQvc2VydmljZXMvaGVnZWwuc2VydmljZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7SHR0cCwgSGVhZGVyc30gZnJvbSAnYW5ndWxhcjIvaHR0cCc7XG5pbXBvcnQge0luamVjdGFibGUsIE91dHB1dCwgRXZlbnRFbWl0dGVyfSBmcm9tICdhbmd1bGFyMi9jb3JlJztcbmltcG9ydCB7U3RvcmV9IGZyb20gJ0BuZ3J4L3N0b3JlJztcbmltcG9ydCAncnhqcy9hZGQvb3BlcmF0b3IvbWFwJztcbmltcG9ydCAncnhqcy9hZGQvb3BlcmF0b3IvdG9Qcm9taXNlJztcbmltcG9ydCAqIGFzIFJ4IGZyb20gJ3J4anMvUngnO1xuZGVjbGFyZSB2YXIgaW86IGFueTtcblxuY29uc3QgQkFTRV9VUkwgPSAnaHR0cDovL2xvY2FsaG9zdDozMDMwL2FwaS8nO1xuY29uc3QgSEVBREVSID0geyBoZWFkZXJzOiBuZXcgSGVhZGVycyh7ICdDb250ZW50LVR5cGUnOiAnaW1hZ2UvanBlZyd9ICl9O1xuXG5ASW5qZWN0YWJsZSgpXG5cbmV4cG9ydCBjbGFzcyBIZWdlbFNlcnZpY2V7XG4gICAgc29ja2V0OmFueTtcbiAgICBzZWxlY3Rpb246IFJ4Lk9ic2VydmFibGU8YW55PjtcbiAgICBtb3VzZXVwOiBSeC5PYnNlcnZhYmxlPGFueT47XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGh0dHA6IEh0dHApIHtcbiAgICAgICAgdGhpcy5zb2NrZXQgPSBpbygnaHR0cDovL2xvY2FsaG9zdDozMDMwJywge3JlY29ubmVjdDogdHJ1ZX0pO1xuICAgICAgICB0aGlzLnNvY2tldC5vbihcIndpa2lTZW5kXCIsIChtc2c6YW55KSA9PiB7XG4gICAgICAgICAgICBtc2cgPSB7bXNnOiBtc2d9O1xuICAgICAgICAgICAgdGhpcy5zb2NrZXQuZW1pdCgncmVjZWl2ZWQnLCBtc2csIGZ1bmN0aW9uIChkYXRhOmFueSkge30pO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5tb3VzZXVwID0gdGhpcy5mcm9tRE9NU291cmNlKCdtb3VzZXVwJywgd2luZG93LmRvY3VtZW50KS5tYXAoKHBvcyk9PntyZXR1cm4gdGhpcy5nZXRTZWxlY3Rpb25UZXh0KHBvcyl9KTtcbiAgICB9XG5cbiAgICBmcm9tRE9NU291cmNlKGV2ZW50TmFtZTogc3RyaW5nLCBlbDogYW55KTogUnguT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIFJ4Lk9ic2VydmFibGUuZnJvbUV2ZW50UGF0dGVybihcbiAgICAgICAgICAgIGNhbGxiYWNrID0+IGVsLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBjYWxsYmFjaywgZmFsc2UpLFxuICAgICAgICAgICAgY2FsbGJhY2sgPT4gZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGNhbGxiYWNrKVxuICAgICAgICApO1xuICAgIH1cbiAgICBoYW5kbGVXaWtpcGVkaWFMaW5rKCRldmVudDphbnkpe1xuICAgICAgICBjb25zb2xlLmxvZyhcIkdvdHRhIGhhbmRsZSB0aGF0IVwiKVxuICAgICAgICBsZXQgaHJlZiA9ICRldmVudC5zcmNFbGVtZW50LmhyZWY7XG4gICAgICAgIGhyZWYgPSBocmVmLnNsaWNlKDI3LCBocmVmLmxlbmd0aCk7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFdpa2koaHJlZik7XG4gICAgfVxuICAgIGdldFdpa2kod29yZDpzdHJpbmcpe1xuICAgICAgICB3b3JkID0gdGhpcy5yZXBsYWNlVW5kZXJzY29yZUFuZENhcCh3b3JkKTtcbiAgICAgICAgd29yZCA9IHdvcmQucmVwbGFjZSgvXFxfL2csXCIgXCIpO1xuICAgICAgICBjb25zb2xlLmxvZyhcIkdldHRpbmcgd29yZFwiICsgd29yZClcbiAgICAgICAgdGhpcy5yZXF1ZXN0V2lraSh3b3JkKS5zdWJzY3JpYmUocmVzID0+IHtcbiAgICAgICAgICAgIHJlcyA9IEpTT04ucGFyc2UocmVzKTtcbiAgICAgICAgICAgIGlmKHJlcy50eXBlID09PSBcImh0bWxcIil7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJIVE1MXCIpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5yZXN1bHRzO1xuICAgICAgICAgICAgfSBlbHNlIGlmKHJlcy50eXBlID09PSAndGVybXMnKXtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRFUk1TXCIpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5yZXN1bHRzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICByZXBsYWNlVW5kZXJzY29yZUFuZENhcCh3b3JkOnN0cmluZyl7XG4gICAgICAgIHdvcmQgPSB3b3JkLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgd29yZC5zbGljZSgxKTtcbiAgICAgICAgd29yZCA9IHdvcmQucmVwbGFjZSgvXFxfL2csXCIgXCIpO1xuICAgICAgICByZXR1cm4gd29yZDtcbiAgICB9XG5cbiAgICBnZXRTZWxlY3Rpb25UZXh0KCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIkdldHRpbmcgc2VsZWN0aW9uIHRleHRcIilcbiAgICAgICAgdmFyIHRleHQgPSBcIlwiO1xuICAgICAgICBpZiAod2luZG93LmdldFNlbGVjdGlvbikge1xuICAgICAgICAgICAgdGV4dCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKS50b1N0cmluZygpO1xuICAgICAgICB9IGVsc2UgaWYgKGRvY3VtZW50LnNlbGVjdGlvbiAmJiBkb2N1bWVudC5zZWxlY3Rpb24udHlwZSAhPSBcIkNvbnRyb2xcIikge1xuICAgICAgICAgICAgICAgIHRleHQgPSBkb2N1bWVudC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKS50ZXh0O1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKFwiU2VsZWN0aW9uIHRleHQ6IFwiICwgdGV4dClcbiAgICAgICAgcmV0dXJuIHRleHQ7XG4gICAgfVxuICAgIGdldEhlZ2VsKG51bTpudW1iZXIpe1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldChCQVNFX1VSTCArIFwiaGVnZWxzL1wiICsgbnVtICwgSEVBREVSKVxuICAgICAgICAgICAgLm1hcChyZXMgPT4gcmVzLmpzb24oKSkubWFwKHJlcyA9PiByZXNbMF0pO1xuICAgIH1cbiAgICByZXF1ZXN0V2lraSh3b3JkOlN0cmluZyl7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiR2V0dGluZyBXaWtpIDpcIiAsIHdvcmQgKTtcbiAgICAgICAgaWYoIHdvcmQgIT09IFwiXCIpe1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQoQkFTRV9VUkwgKyBcIndpa2kvXCIgKyB3b3JkKVxuICAgICAgICAgICAgICAgIC5tYXAocmVzID0+IHJlcy5fYm9keSk7XG4gICAgICAgIH0gXG4gICAgfVxuXG4gIC8vICAgIHRoaXMuaXRlbXMgPSBzdG9yZS5zZWxlY3QoJ2l0ZW1zJyk7IC8vR3JhYmJpbmcgdGhpcyBjb2xsZWN0aW9uIFN0b3JlID0gQSBkYXRhYmFzZSBmb3IgdGhlIGFwcGxpY2F0aW9uIC0tIEEgcmVkdWNlciBkZWZpbmUgYSB0YWJsZSAtLSBTdG9yZS5zZWxlY3QgaXMgYSBkYXRhYmFzZSBxdWVyeSBcbiAvLyB9XG5cbiAgLy8gbG9hZEl0ZW1zKCkge1xuICAvLyAgIHRoaXMuaHR0cC5nZXQoQkFTRV9VUkwpXG4gIC8vICAgICAubWFwKHJlcyA9PiByZXMuanNvbigpKVxuICAvLyAgICAgLm1hcChwYXlsb2FkID0+ICh7IHR5cGU6ICdBRERfSVRFTVMnLCBwYXlsb2FkIH0pKVxuICAvLyAgICAgLnN1YnNjcmliZShhY3Rpb24gPT4gdGhpcy5zdG9yZS5kaXNwYXRjaChhY3Rpb24pKTtcbiAgLy8gfVxuXG4gIC8vIHNhdmVJdGVtKGl0ZW06IEl0ZW0pIHtcbiAgLy8gICAoaXRlbS5pZCkgPyB0aGlzLnVwZGF0ZUl0ZW0oaXRlbSkgOiB0aGlzLmNyZWF0ZUl0ZW0oaXRlbSk7XG4gIC8vIH1cblxuICAvLyBjcmVhdGVJdGVtKGl0ZW06IEl0ZW0pIHtcbiAgLy8gICB0aGlzLmh0dHAucG9zdChgJHtCQVNFX1VSTH1gLCBKU09OLnN0cmluZ2lmeShpdGVtKSwgSEVBREVSKVxuICAvLyAgICAgLm1hcChyZXMgPT4gcmVzLmpzb24oKSlcbiAgLy8gICAgIC5tYXAocGF5bG9hZCA9PiAoeyB0eXBlOiAnQ1JFQVRFX0lURU0nLCBwYXlsb2FkIH0pKVxuICAvLyAgICAgLnN1YnNjcmliZShhY3Rpb24gPT4gdGhpcy5zdG9yZS5kaXNwYXRjaChhY3Rpb24pKTtcbiAgLy8gfVxuXG4gIC8vIHVwZGF0ZUl0ZW0oaXRlbTogSXRlbSkge1xuICAvLyAgIHRoaXMuaHR0cC5wdXQoYCR7QkFTRV9VUkx9JHtpdGVtLmlkfWAsIEpTT04uc3RyaW5naWZ5KGl0ZW0pLCBIRUFERVIpXG4gIC8vICAgICAuc3Vic2NyaWJlKGFjdGlvbiA9PiB0aGlzLnN0b3JlLmRpc3BhdGNoKHsgdHlwZTogJ1VQREFURV9JVEVNJywgcGF5bG9hZDogaXRlbSB9KSk7XG4gIC8vIH1cblxuICAvLyBkZWxldGVJdGVtKGl0ZW06IEl0ZW0pIHtcbiAgLy8gICB0aGlzLmh0dHAuZGVsZXRlKGAke0JBU0VfVVJMfSR7aXRlbS5pZH1gKVxuICAvLyAgICAgLnN1YnNjcmliZShhY3Rpb24gPT4gdGhpcy5zdG9yZS5kaXNwYXRjaCh7IHR5cGU6ICdERUxFVEVfSVRFTScsIHBheWxvYWQ6IGl0ZW0gfSkpO1xuICAvLyB9XG59XG4iXX0=
